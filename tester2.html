<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Executor</title>
</head>
<body>
    <h1>Code Executor</h1>
    <form id="codeForm">
        <textarea id="codeInput" rows="10" cols="50" placeholder="Enter your code here..."></textarea><br>
        <select id="languageSelect">
            <option value="python">Python</option>
            <option value="java">Java</option>
            <option value="c">C</option>
            <option value="cpp">C++</option>
            <!-- 원하는 언어 추가 -->
        </select><br><br>// 1단계: 실행할 코드와 언어 설정
        const executeCode = async () => {
          const apiUrl = 'https://ideone.com/api/1/service.json';
          const apiKey = 'YOUR_API_KEY'; // 발급받은 API 키 입력
          const language = 'java'; // Java 언어로 설정
          const code = `
            public class Main {
                public static void main(String[] args) {
                    System.out.println("Hello, Ideone!");
                }
            }
          `; // 실행할 코드
        
          // 2단계: 코드 실행 요청
          const executeResponse = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              key: apiKey,
              source: code,
              language: language,
              input: '', // 입력이 필요 없다면 빈 문자열
            }),
          });
        
          const executeData = await executeResponse.json();
          console.log('Execution started:', executeData);
        
          if (executeData.status === 'OK') {
            const submissionId = executeData.link; // 실행한 코드의 submissionId
            // 3단계: 결과 요청
            await getExecutionResult(submissionId);
          } else {
            console.error('Error executing code:', executeData);
          }
        };
        
        // 3단계: 실행 결과 확인
        const getExecutionResult = async (submissionId) => {
          const apiUrl = 'https://ideone.com/api/1/service.json';
          const apiKey = 'YOUR_API_KEY'; // 발급받은 API 키 입력
        
          let status = '';
          let output = '';
          
          // 결과 상태가 COMPLETED가 될 때까지 폴링
          while (status !== 'COMPLETED') {
            const resultResponse = await fetch(apiUrl, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                key: apiKey,
                action: 'getSubmissionStatus',
                link: submissionId,
              }),
            });
        
            const resultData = await resultResponse.json();
            status = resultData.status;
            console.log('Current status:', status);
        
            if (status === 'COMPLETED') {
              output = resultData.output; // 실행 결과
              console.log('Execution Result:', output);
            } else {
              console.log('Waiting for result...');
              await new Promise(resolve => setTimeout(resolve, 2000)); // 2초마다 폴링
            }
          }
        };
        
        // 코드 실행
        executeCode();
        
        <button type="submit">Run Code</button>
    </form>

    <h3>Output:</h3>
    <pre id="output"></pre>

    <script>
        // 서버에서 Ideone API와 상호작용하기 위한 AJAX 요청
        document.getElementById("codeForm").addEventListener("submit", function(event) {
            event.preventDefault(); // 기본 제출 동작 방지

            var code = document.getElementById("codeInput").value;
            var language = document.getElementById("languageSelect").value;


            // API 요청을 보낼 데이터
           
            data = {
                user: 'suikari',
                pass: '!test1234',
                lang: 'python',
                source : 'print("Hello, World!")'
            };

            axios({
                url: 'https://ideone.com/api/1/service.json',
                method: 'POST',
                headers: {
                    'cors-proxy-url' : 'https://ideone.com/' // 이 부분을 이용하는 서버 URL로 변경
                },
                data : data 
            }).then((res) => {
                console.log('Response Data:', res.data);  // 서버 응답 데이터
            }).catch((error) => {
                console.error('Error:', error);  // 에러 처리
            });
    
        });
    </script>
</body>
</html>

<script src='https://cdnjs.cloudflare.com/ajax/libs/axios/1.1.3/axios.min.js'></script>
